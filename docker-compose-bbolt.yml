version: '3.4'
services:
  bitcoind:
    image: kylemanna/bitcoind
    volumes:
      - ./bitcoin.conf:/bitcoin/.bitcoin/bitcoin.conf

  lnd-alice:
    restart: unless-stopped
    build:
      context: lnd
      args:
        repo: https://github.com/ellemouton/lnd
        checkout: 5c9f79dd42f4911ad5446be4066edfcf38a7e539
        tags: signrpc walletrpc chainrpc invoicesrpc monitoring kvdb_sqlite
    depends_on:
      - bitcoind
    volumes:
      - ./lnd.conf:/root/.lnd/lnd.conf
      - lnd-alice:/cfg
    ports:
      - 5000:5000
    command: --tlsextradomain=lnd-alice --db.backend=sqlite --db.sqlite.pragmaoptions=synchronous=full --db.sqlite.maxconnections=2

  lnd-bob:
    restart: unless-stopped
    build:
      context: lnd
      args:
        repo: https://github.com/ellemouton/lnd
        checkout: 5c9f79dd42f4911ad5446be4066edfcf38a7e539
        tags: signrpc walletrpc chainrpc invoicesrpc monitoring kvdb_sqlite
    depends_on:
      - bitcoind
    ports:
      - 5001:5000
    volumes:
      - ./lnd.conf:/root/.lnd/lnd.conf
      - lnd-bob:/cfg
    command: --tlsextradomain=lnd-bob --db.backend=sqlite --db.sqlite.pragmaoptions=synchronous=full --db.sqlite.maxconnections=2

  loadtest:
    build: loadtest
    depends_on:
      - lnd-alice
      - lnd-bob
    volumes:
      - lnd-alice:/lnd-alice
      - lnd-bob:/lnd-bob
      - ./${LOADTEST_CONFIG_FILE}:/loadtest.yml

volumes:
  lnd-alice:
  lnd-bob:
    
